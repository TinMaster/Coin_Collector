pico-8 cartridge // http://www.pico-8.com
version 16
__lua__

coins = {}
enemies = {}

function create_player()
	local p = {}
	p.x = 64
	p.y = 64
	p.score = 0
	p.health = 3
	p.iframe = 0
	p.sp = 1
	
	--movement/update function
	p.update = function()
		if(btnp(⬅️)) then
		if(cmap(player.x - 8 , player.y) == false) then
			player.x -= 8
		else
			sfx(0)
		end
	elseif(btnp(➡️)) then
		if(cmap(player.x + 8 , player.y) == false) then
			player.x += 8
		else
			sfx(0)
		end
	elseif(btnp(⬆️)) then
		if(cmap(player.x, player.y - 8) == false) then
			player.y -= 8 
		else
			sfx(0)
		end
	elseif(btnp(⬇️)) then
		if(cmap(player.x, player.y + 8) == false) then
		 player.y += 8
		
		else
			sfx(0)
		 
		end
	end
	
	if p.health == 0 then
		_init = gameover_init()
	end	
	if p.iframe > 0 then
		p.iframe -= 1
	end
	
	end
	
	p.draw = function()
		palt(0,false)		
		spr(p.sp, p.x, p.y )
		pal(0,true) --toggle opacity
		
		if (flr(p.iframe / 5) % 2 == 0) then
		--	p.sp = 0
		end
	end
	
	return p
end

function create_enemy()
	local e = random_cords() 
	add(enemies, e)
	
	e.draw = function()
		palt(0,false)
		spr(23, e.x, e.y)
	end
	
	e.update = function()
	end
	
	return e
	
end

function create_coin()
	local c = random_cords()
	
	add(coins,c)
	c.draw = function(this)
		spr(19,this.x, this.y)
	end
	
	return c

end

--helper functions
function generate_coins()
	for i = 1, 5 + lvl do
		create_coin()
	end
end

function generate_enemies()
	for i = 1, 5 do	
		create_enemy()
	end
end

function random_cords()
	local r = {}
	
	local x = flr(rnd(112) + 8) 
	local y = flr(rnd(104) + 16) 
	 
	r.x = x - (x%8)
	r.y = y - (y%8) 
		
	return r

end

--collision--
 function col(x1,x2,xw,xh,y1,y2,yw,yh)
 	if	(x1> y1 + yw) then
 	 return false
	 end
	 if(x1 + xw < y1) then
 	 return false
	 end
	 if(x2 > y2 + yh) then
 	 return false
	 end
	 if(xh + x2 < y2) then
 	 return false
 	end
	 return true
 end

function col_things(o,objs)
	for obj in all(objs) do
	 --return col(o.x, o.y, 4,4, obj.x,obj.y,4,4)
		if o.x == obj.x and o.y == obj.y then
			return true
		end
	end
	
	return false
end

function chk_collision()
	for coin in all(coins) do
		if col(player.x, player.y,	4,4, coin.x, coin.y, 4, 4) then
		 	del(coins,coin)
				sfx(1)
				player.score += 1				
		end
	end
	
	for enemy in all(enemies) do
			if col(player.x, player.y,	4,4, enemy.x, enemy.y, 4, 4) and player.iframe == 0 then
				player.health -= 1
				sfx(2,2)
				player.iframe = 30
			end
	end
	
	if(#coins == 0) then
		lvl += 1
		generate_coins()
	end
end
-------------
function _init()
	lvl = 1
	player = create_player()
	generate_coins()	
	generate_enemies()
	
end


function _update()
	player.update()
	chk_collision()
end

function debug()
	color(2)
	print("x: "..player.x,0,10)
	print("y: "..player.y,0,16)
 print("tile x: ".. (player.x - (player.x % 8)) / 8,0,22)
	print("tile y: ".. (player.y - (player.y % 8)) / 8,0,28)
	print(cmap(player.x,player.y),0,34)
	print("enemies: "..#enemies,0,40)	
	print("coins: "..#coins,0,46)
end

function _draw()
	cls()
	map(0,0)
	palt(0,true)
	
	--different code same thing
	foreach(coins, function(obj)
		obj.draw(obj)
	end)
	
	for enemy in all(enemies) do
		enemy.draw()
	end		
	player.draw()
	draw_bar()
	debug()
	
end

function draw_bar()
	x1 = 0
	for i = 1, 3 do
		spr(22,x1,0)
		x1+=8
	end

	x = 0
	for i = 1, player.health do
		spr(21,x,0)
		x+=8
	end
	color(7)
	print("score:"..player.score,28,1)
	print("level:"..lvl,92,1)
end
function cmap(x ,y)
	local tilex = (x - (x % 8)) / 8 
	local tiley = (y - (y % 8)) / 8
	if fget(mget(tilex, tiley),0) then
		return true
	else
		return false
	end
end

--gameover screen
function gameover_init()
	_update = gameover_update()
	_draw = gameover_draw()
end

function gameover_update()
end

function gameover_draw()	
--	rectfill(32,32,96,96,5)
	rectfill(8,16,119,119)
	print("game over")
end

--menu screen
function menu_init()
	_update = menu_update()
	_draw = menu_draw()
end

function menu_update()
end

function memu_draw()
end

__gfx__
00000000c777777c00000000c777777cc777777c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007ccc0c07000000007cccccc77cccccc70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007ccc0c07000000007ccc0c077cccccc70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007ccc0c07000000007cccccc77cccccc70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007cccccc7000000007cccccc77cccccc70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007cccccc7000000007cccccc77cccccc70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007cccccc7000000007cccccc77cccccc70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c777777c00000000c777777cc777777c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666166dddddddd11aaaa1100000000188888810880880008808800855555580000000000000000000000000000000000000000000000000000000000000000
66666166dddddddd1a997aa10aaaaaa0118888118888888080080080588808050000000000000000000000000000000000000000000000000000000000000000
66666166dddddddda9977aaa0a0000a0111881118888888080000080588808050000000000000000000000000000000000000000000000000000000000000000
11111111dddddddda77aaaaa0a0aa0a0111881118888888080000080588808050000000000000000000000000000000000000000000000000000000000000000
66616666ddddddddaaaaa77a0a0aa0a0111881110888880008000800588888850000000000000000000000000000000000000000000000000000000000000000
66616666ddddddddaaaa799a0a0000a0111881110088800000808000588888850000000000000000000000000000000000000000000000000000000000000000
66616666dddddddd1aa799a10aaaaaa0111881110008000000080000588888850000000000000000000000000000000000000000000000000000000000000000
11111111dddddddd11aaaa1100000000111881110000000000000000855555580000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd0000000000000000888888800880880000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd00000000000000008888888087e8e88000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd0000000000000000888888808ee8888000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd0000000000000000888888808888888000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd0000000000000000888888800888880000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd0000000000000000888888800088800000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd0000000000000000888888800008000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dddddddd0000000000000000888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000001000000010000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3f3f3f3f3f3f3f3f3f3f3f3f3f3f3f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3f3e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3f003f3f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003f3f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00003f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0003000015030140300f0300c0300a0300803005030030300330001300023000d3000b300063000230003300002000020000200002000020000200002000020000200002002b0000020000200002000020000200
000300002a5352f53533535385353d5353f535106051060510605106051060511605126051260512605126051260511605116052010521105231052410526105281052a1050f4052500525005054050f50511205
000600002235321350203531d35018355123500c3530a3500730014304143001430014305000002b60500000183030c000240030000030605000000c1033c305396003b604396000130001305123001230513300
01100000224751f475244752247622435244751f4711b475184751b471224751347716472184751b4710c372185771b5571d5371b517225771f5571d5371b5171d577225571f5371b5171d5771f557185371b517
011000000356527500275652756235125292422a12229075290242935527077272752417222275225721d4771f3751b7721b5771b27518172164751b372167751357213177132751147211777113750f57211175
011000000c77618576187760c57518775185750c775185750c775187750c57518775187750c575187751857518775247752457518775245751877524575247751877524575187752457524775185752477524575
01100000184761b166185561b246184761b3661d5561b746181761d266184561d346187761d5661f1561d4461a2761d7661f3561d5461a4761d166222561d7461a5761f366224561f1461d2761f7662255624346
011000001817018170181701817000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500
011000000c175182750c475185751b176182751d4751f5750c175182750c475185751b175182751d4751f5750c175182770c175182750c175182750c175182750c176182560c1361821618176242563013624216
01100000187702477018770247701f77024770227702b77030777297772b777247771d777247771d7771f777185702447018270241701f57024470222702b17030576355762b57629576185761d576135760c576
__music__
05 01414141
00 01020541
00 01020341
00 01020341
00 01020441
00 01020341
00 08414141
00 08094141
00 01020809
00 01020809
00 01024106
02 01020809
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141
00 41414141

